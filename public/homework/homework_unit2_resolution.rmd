---
title: "Resolution exercise 1"
output: 
  html_document: 
    css: ec.css
    theme: yeti
    toc: true
    toc_float: true
    fig_caption: false
---

```{r echo = F, warning = F , message = F}
knitr::opts_chunk$set(echo = TRUE, message = F)
library(tidyverse)
fires <- read.csv('data/fires.csv')
```

1.  Calculate *yearly* totals of fire counts and burned area. Disregard CAUSE 6 (restarted fires).

```{r question1}
fires %>%
    filter(CAUSE != 6) %>% 
    group_by(YEAR) %>%
    summarise(N=n(),BA=sum(BAREA))
  
```

2.  Which MONTH endured the *largest amount of fires*? Which MONTH endured the *largest amount of burned area*?

```{r question2a}
fires %>%
    group_by(MONTH) %>%
    summarise(N=n()) %>%
    arrange(desc(N)) %>%
    slice(1)

```

```{r question2a_2option}
fires %>%
    group_by(MONTH) %>%
    summarise(N=n_distinct(IDPIF)) %>%
    arrange(desc(N)) %>%
    slice(1)

```

> The month with the largest amount of fires is August

```{r question2b}
fires %>%
    group_by(MONTH) %>%
    summarise(BA=sum(BAREA)) %>%
    arrange(desc(BA)) %>%
    slice(1)

```

> The month with the largest amount of burned area is also August, month 8, with 2,177,498.34 ha

3.  What CAUSE has the highest average fire size?

Here you could either use the `mean` function or calculate the ratio between burned area and fire size.

```{r question 3}
fires %>%
    group_by(CAUSE) %>%
    summarise(N = n(),
              BA = sum(BAREA),
              AvgSIZE = BA/N,mean(BAREA))

```

4.  Which CCAA has the highest *amount* of natural fires?

```{r question4, warning= F}
fires %>%
    filter(CAUSE == 1) %>%
    group_by(CCAA) %>%
    summarise(N=n()) %>%
    arrange(desc(N))
  
```

> The CCAA with highest amount of natural fires is "Castilla y León" with 1393 fires

5.  Which CCAA has the highest *proportion* of natural fires?

```{r question5, warning = F}
fires %>% 
  group_by(CCAA) %>% 
  mutate(nFires = n()) %>% 
  select(CAUSE, CCAA, nFires) %>% 
  filter(CAUSE == "1") %>% 
  mutate(nNaturalFires = n()) %>% 
  mutate(proportion = nNaturalFires/nFires) %>% 
  arrange(desc(proportion))

```

```{r}
fires %>%
    group_by(CCAA,CAUSE) %>%
    summarise(N=n()) %>%
    mutate(Prop = round((N/sum(N)*100),2)) %>%
    filter(CAUSE == 1) %>%
    arrange(desc(Prop))
```

> The province of Aragón has the highest proportion of natural fires = 16%
