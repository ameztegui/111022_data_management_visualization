<!DOCTYPE html>
<html>
  <head>
    <title>Scientific studies, confounding, and Simpson’s paradox</title>
    <meta charset="utf-8">
    <meta name="author" content="Dr. Çetinkaya-Rundel" />
    <meta name="date" content="2018-02-12" />
    <link href="libs/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Scientific studies, confounding, and Simpson’s paradox
### Dr. Çetinkaya-Rundel
### 2018-02-12

---







## Announcements

- HW 02 due tonight at 11:59pm
- Lab 04 due Thursday at noon
- Midterm 01 due Friday at 11:59pm -- read the exam rules!
- Extra credit (sorry, it's coming, you'll have plenty of time!)

---

class: center, middle

# Scientific studies

---

## Scientific studies

- Observational
    - Collect data in a way that does not interfere with how the data arise ("observe")
    - Only establish an association

- Experimental
    - Randomly assign subjects to treatments
    - Establish causal connections

.question[
Design a study comparing average energy levels of people who do and do not exercise -- both as an observational study and as an experiment.
]

---

## Study: Bfast cereal keeps girls slim

Girls who ate breakfast of any type had a lower average body mass index, a common obesity gauge, than those who said they didn't. The index was even lower for girls who said they ate cereal for breakfast, according to findings of the study conducted by the Maryland Medical Research Institute with funding from the National Institutes of Health (NIH) and cereal-maker General Mills.
 
[...]
 
The results were gleaned from a larger NIH survey of 2,379 girls in California, Ohio, and Maryland who were tracked between the ages of 9 and 19.
 
[...]
 
As part of the survey, the girls were asked once a year what they had eaten during the previous three days.
 
[...]

.question[
What is the explanatory and what is the response variable?
]

---

### 3 possible explanations

--

1. Eating breakfast causes girls to be slimmer 

--

2. Being slim causes girls to eat breakfast

--

3. A third variable is responsible for both -- a **confounding** variable: an extraneous variable that affects both the explanatory and the response variable, and that make it seem like there is a relationship between them

---

## Correlation != causation

![](img/05a/xkcdcorrelation.png)

&lt;br&gt;&lt;br&gt;&lt;br&gt;

Randall Munroe CC BY-NC 2.5 http://xkcd.com/552/

---

## Studies and conclusions

![](img/05a/random_sample_assign_grid.png)

---

class: center, middle

# Conditional probability

---

## Conditional probability

**Notation**: `\(P(A | B)\)`: Probability of event A given event B

- What is the probability that it be unseasonably warm tomorrow?

- What is the probability that it be unseasonably warm tomorrow, given that it it was unseasonably warm tomorrow?

---

.question[
A January 2018 SurveyUSA poll asked 500 randomly selected Californians whether they are familiar with the DREAM act. The distribution of the responses by age category are shown below.

What percent of **all respondents** are very familiar with the DREAM act?
]

&lt;br&gt;

|            | 18 - 49 | 50+ | Total |
|------------|---------|-----|-------|
| Very       | 90      | 32  | 122   |
| Somewhat   | 125     | 86  | 211   |
| Not very   | 56      | 33  | 89    |
| Not at all | 36      | 24  | 60    |
| Not sure   | 9       | 9   | 18    |
| Total      | 316     | 184 | 500   |

--

`\(P(Very) = \frac{122}{500} = 0.244\)`

&lt;br&gt;

Source: [SurveyUSA News Poll 23754](http://www.surveyusa.com/client/PollReport.aspx?g=783743b0-efc1-4b67-9201-58352a8f61f1)

---

.question[
A January 2018 SurveyUSA poll asked 500 randomly selected Californians whether they are familiar with the DREAM act. The distribution of the responses by age category are shown below.

What percent of **respondents who are 18 - 49 years old** are very familiar with the DREAM act?
]

&lt;br&gt;

|            | 18 - 49 | 50+ | Total |
|------------|---------|-----|-------|
| Very       | 90      | 32  | 122   |
| Somewhat   | 125     | 86  | 211   |
| Not very   | 56      | 33  | 89    |
| Not at all | 36      | 24  | 60    |
| Not sure   | 9       | 9   | 18    |
| Total      | 316     | 184 | 500   |

--

`\(P(Very~|~18-49) = \frac{90}{316} = 0.285\)`

Source: [SurveyUSA News Poll 23754](http://www.surveyusa.com/client/PollReport.aspx?g=783743b0-efc1-4b67-9201-58352a8f61f1)

---

.question[
A January 2018 SurveyUSA poll asked 500 randomly selected Californians whether they are familiar with the DREAM act. The distribution of the responses by age category are shown below.

What percent of **respondents who are 50+ years old** are very familiar with the DREAM act?
]

&lt;br&gt;

|            | 18 - 49 | 50+ | Total |
|------------|---------|-----|-------|
| Very       | 90      | 32  | 122   |
| Somewhat   | 125     | 86  | 211   |
| Not very   | 56      | 33  | 89    |
| Not at all | 36      | 24  | 60    |
| Not sure   | 9       | 9   | 18    |
| Total      | 316     | 184 | 500   |

--

`\(P(Very~|~50+) = \frac{32}{184} = 0.173\)`

Source: [SurveyUSA News Poll 23754](http://www.surveyusa.com/client/PollReport.aspx?g=783743b0-efc1-4b67-9201-58352a8f61f1)

---

.question[
Given that

- `\(P(Very) = \frac{122}{500} = 0.244\)`
- `\(P(Very~|~18-49) = \frac{90}{316} = 0.285\)`
- `\(P(Very~|~50+) = \frac{32}{184} = 0.173\)`

does there appear to be a relationship between age and familiarity with the DREAM act? Explain your reasoning.
]

--

&lt;br&gt;

.question[
Could there be another variable that explains this relationship?
]

---

## Independence

.question[
Inspired by the previous example and how we used the conditional probabilities to make conclusions, come up with a definition of independent events. If easier, you can keep the context limited to the example (independence/dependence of familiarity with the DREAM act and age), but try to push yourself to make a more general statement.
]

---

class: center, middle

# Simpson's paradox

---

## Relationships between variables

- Bivariate relationship: Fitness -&gt; Heart health

- Multivariate relationship: Calories + Age + Fitness -&gt; Heart health

---

## Simpson's paradox

- Not considering an important variable when studying a relationship can result in what we call a **Simpson's paradox**, which illustrates the effect the omission of an explanatory variable can have on the measure of association between another explanatory variable and a response variable. 

- In other words, the inclusion of a third variable in the analysis can change the apparent relationship between the other two variables. 

![](img/05a/simpsons_paradox.jpeg)

---

## Berkeley admission data

- Study carried out by the graduate Division of the University of California, Berkeley in the early 70’s to evaluate whether there was a sex bias in graduate admissions

- The data come from six departments. For confidentiality we'll call them A-F. 

- We have information on whether the applicant was male or female and whether they were admitted or rejected. 

- First, we will evaluate whether the percentage of males admitted is indeed higher than females, overall. Next, we will calculate the same percentage for each department.

---

## Data


```r
ucb_admit &lt;- read_csv("data/ucb_admit.csv")
ucb_admit
```

```
## # A tibble: 4,526 x 3
##    Admit    Gender Dept 
##    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;
##  1 Admitted Male   A    
##  2 Admitted Male   A    
##  3 Admitted Male   A    
##  4 Admitted Male   A    
##  5 Admitted Male   A    
##  6 Admitted Male   A    
##  7 Admitted Male   A    
##  8 Admitted Male   A    
##  9 Admitted Male   A    
## 10 Admitted Male   A    
## # ... with 4,516 more rows
```

---

## Glimpse at the data


```r
glimpse(ucb_admit)
```

```
## Observations: 4,526
## Variables: 3
## $ Admit  &lt;chr&gt; "Admitted", "Admitted", "Admitted", "Admitted", "Admitt...
## $ Gender &lt;chr&gt; "Male", "Male", "Male", "Male", "Male", "Male", "Male",...
## $ Dept   &lt;chr&gt; "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", ...
```

---

## Overall gender distribution

.question[
What can you say about the overall gender distribution? Hint: Calculate the following probabilities: `\(P(Admit | Male)\)` and `\(P(Admit | Female)\)`.
]


```r
ucb_admit %&gt;%
  count(Gender, Admit)
```

```
## # A tibble: 4 x 3
##   Gender Admit        n
##   &lt;chr&gt;  &lt;chr&gt;    &lt;int&gt;
## 1 Female Admitted   557
## 2 Female Rejected  1278
## 3 Male   Admitted  1198
## 4 Male   Rejected  1493
```

---

## Overall gender distribution

.question[
What type of visualization would be appropriate for representing these data?
]


```r
ucb_admit %&gt;%
  count(Gender, Admit) %&gt;%
  group_by(Gender) %&gt;%
  mutate(prop_admit = n / sum(n))
```

```
## # A tibble: 4 x 4
## # Groups:   Gender [2]
##   Gender Admit        n prop_admit
##   &lt;chr&gt;  &lt;chr&gt;    &lt;int&gt;      &lt;dbl&gt;
## 1 Female Admitted   557      0.304
## 2 Female Rejected  1278      0.696
## 3 Male   Admitted  1198      0.445
## 4 Male   Rejected  1493      0.555
```

---

## Overall gender distribution


```r
ggplot(ucb_admit, mapping = aes(x = Gender, fill = Admit)) +
  geom_bar(position = "fill") + 
  labs(y = "", title = "Admit by gender")
```

![](05a-studies-confounding-simpsons-paradox_files/figure-html/unnamed-chunk-5-1.png)&lt;!-- --&gt;

---

## Gender distribution, by department

.question[
What can you say about the by department gender distribution?
]


```r
ucb_admit %&gt;%
  count(Dept, Gender, Admit)     # ---&gt;
```

```
## # A tibble: 24 x 4
##    Dept  Gender Admit        n
##    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;int&gt;
##  1 A     Female Admitted    89
##  2 A     Female Rejected    19
##  3 A     Male   Admitted   512
##  4 A     Male   Rejected   313
##  5 B     Female Admitted    17
##  6 B     Female Rejected     8
##  7 B     Male   Admitted   353
##  8 B     Male   Rejected   207
##  9 C     Female Admitted   202
## 10 C     Female Rejected   391
## # ... with 14 more rows
```

---

.small[

```r
ucb_admit %&gt;%
  count(Dept, Gender, Admit) %&gt;%
  print(n = 24)
```

```
## # A tibble: 24 x 4
##    Dept  Gender Admit        n
##    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;int&gt;
##  1 A     Female Admitted    89
##  2 A     Female Rejected    19
##  3 A     Male   Admitted   512
##  4 A     Male   Rejected   313
##  5 B     Female Admitted    17
##  6 B     Female Rejected     8
##  7 B     Male   Admitted   353
##  8 B     Male   Rejected   207
##  9 C     Female Admitted   202
## 10 C     Female Rejected   391
## 11 C     Male   Admitted   120
## 12 C     Male   Rejected   205
## 13 D     Female Admitted   131
## 14 D     Female Rejected   244
## 15 D     Male   Admitted   138
## 16 D     Male   Rejected   279
## 17 E     Female Admitted    94
## 18 E     Female Rejected   299
## 19 E     Male   Admitted    53
## 20 E     Male   Rejected   138
## 21 F     Female Admitted    24
## 22 F     Female Rejected   317
## 23 F     Male   Admitted    22
## 24 F     Male   Rejected   351
```
]

---

## Gender distribution, by department

.question[
What type of visualization would be appropriate for representing these data?
]

.small[

```r
ucb_admit %&gt;%
  count(Dept, Gender, Admit) %&gt;%
  group_by(Dept, Gender) %&gt;%
  mutate(Perc_Admit = n / sum(n)) %&gt;%
  filter(Admit == "Admitted")
```

```
## # A tibble: 12 x 5
## # Groups:   Dept, Gender [12]
##    Dept  Gender Admit        n Perc_Admit
##    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;int&gt;      &lt;dbl&gt;
##  1 A     Female Admitted    89     0.824 
##  2 A     Male   Admitted   512     0.621 
##  3 B     Female Admitted    17     0.680 
##  4 B     Male   Admitted   353     0.630 
##  5 C     Female Admitted   202     0.341 
##  6 C     Male   Admitted   120     0.369 
##  7 D     Female Admitted   131     0.349 
##  8 D     Male   Admitted   138     0.331 
##  9 E     Female Admitted    94     0.239 
## 10 E     Male   Admitted    53     0.277 
## 11 F     Female Admitted    24     0.0704
## 12 F     Male   Admitted    22     0.0590
```
]

---

## Gender distribution, by department


```r
ggplot(ucb_admit, mapping = aes(x = Gender, fill = Admit)) +
  geom_bar(position = "fill") +
  facet_grid(. ~ Dept) +
  labs(x = "Gender", y = "", fill = "Admission",
       title = "Admit by gender by department")
```

![](05a-studies-confounding-simpsons-paradox_files/figure-html/unnamed-chunk-9-1.png)&lt;!-- --&gt;

---

class: center, middle

# What else do I need to know from this week's reading?

---

## Short answer

Everything 😜

---

## Long answer

Be able to identify

- whether a study is observational or experiment, and further features of the study design

- sources of bias in a study

- misrepresentations in summaries of study results (in popular media or in scientific literature)

---

## Any questions?


on the reading, or otherwise?

---

class: center, middle

# Coding style

---

## Style guide

&gt;"Good coding style is like correct punctuation: you can manage without it, butitsuremakesthingseasiertoread."
&gt;
&gt;Hadley Wickham

- Style guide for this course is based on the Tidyverse style guide: http://style.tidyverse.org/

- There's more to it than what we'll cover today, but we'll mention more as we introduce more functionality, and do a recap later in the semester

---

## File names and code chunk labels

- Do not use spaces in file names, use `-` or `_` to separate words
- Use all lowercase letters


```r
# Good
ucb-admit.csv

# Bad
UCB Admit.csv
```

---

## Object names

- Use `_` to separate words in object names
- Use informative but short object names
- Do not reuse object names within an analysis


```r
# Good
acs_employed

# Bad
acs.employed
acs2
acs_subset
acs_subsetted_for_males
```

---

## Spacing

- Put a space before and after all infix operators (=, +, -, &lt;-, etc.), and when naming arguments in function calls. 
- Always put a space after a comma, and never before (just like in regular English).


```r
# Good
average &lt;- mean(feet / 12 + inches, na.rm = TRUE)

# Bad
average&lt;-mean(feet/12+inches,na.rm=TRUE)
```

---

## ggplot

- Always end a line with `+`
- Always indent the next line


```r
# Good
ggplot(diamonds, mapping = aes(x = price)) +
  geom_histogram()

# Bad
ggplot(diamonds,mapping=aes(x=price))+geom_histogram()
```

---

## Long lines

- Limit your code to 80 characters per line. This fits comfortably on a printed page with a reasonably sized font.

- Take advantage of RStudio editor's auto formatting for indentation at line breaks.

---

## Assignment

- Use `&lt;-` not `=`


```r
# Good
x &lt;- 2

# Bad
x = 2
```

---

## Quotes

Use `"`, not `'`, for quoting text. The only exception is when the text already contains double quotes and no single quotes.


```r
ggplot(diamonds, mapping = aes(x = price)) +
  geom_histogram() +
  # Good
  labs(title = "`Shine bright like a diamond`",
  # Good
       x = "Diamond prices",
  # Bad
       y = 'Frequency')
```
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
