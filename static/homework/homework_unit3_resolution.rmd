---
title: "Resolution homework unit 3"
output: 
  html_document: 
    css: ec.css
    theme: yeti
    toc: true
    toc_float: true
    fig_caption: false
---

```{r echo = F, warning = F , message = F}
knitr::opts_chunk$set(echo = TRUE, message = F)
library(tidyverse)
library(readxl)
```

1.  Import the data on seedling diameters from the `seedlings_growth.txt` file. Are all the columns correctly parsed as numeric? If not, look for the reason and correct it

```{r question1}
data_seedlings <- read_tsv("./data/seedlings_growth.txt", 
                           na = "Dead")  
```

2.  Repeat the operation, but now ensure that species and site are parsed as factors

```{r question2}
data_seedlings <- read_tsv("./data/seedlings_growth.txt", 
                           na = "Dead",
                           col_types = cols(Site = col_factor(),
                                            Species = col_factor())) 
```

3.  It seems to me that these data may not be in a tidy format. Why? Modify the data to make it tidy. This will allow us to relate seedling size to light availability

```{r question3}
data_long <- pivot_longer(data_seedlings, 
                          cols = Diam_2015:Diam_2017,
                          names_to = "Year",
                          names_prefix = "Diam_",
                          values_to = "Diam")


data_long_all <- pivot_longer(data_seedlings, 
                          cols = Diam_2015:Hei_2017,
                          names_to = c(".value", "Year"),
                          names_pattern  = "(.+)_(.+)")

    #pivot both diameter and height columns

foo <- pivot_longer(data_seedlings, cols = c(Diam_2015, Diam_2016, Diam_2017,
                                       Hei_2015, Hei_2016, Hei_2017), 
                    names_to = c("D_H", "Year"),
                    names_prefix = "/[^_]*/",
                    names_sep = "_",
                    values_to = "length")


foo2 <- foo %>%
    pivot_wider(names_from = D_H,
                values_from = length)
```

4.  Now we need to import light availability values from the Excel file `data_seedlings.xlsx.` Please verify, after importing, that the data is well read.

```{r question4}
data_light <- read_excel("./data/data_seedlings.xlsx",
                         sheet = "light_values", skip = 4)
```

5.  Ok, so now it's time to relate size and light availability. As I said before, I am not sure which approach to follow. Help me get both, and I will grant you an extra point in the homework. So we need to join both tables you have imported, so that I can :

    - Have all the size data, and assign one light value for each size measurement, regardless the year

    ```{r question5a}
    data <- left_join(data_long, data_light,
                      by = c("Site" = "Site", "Tree_number" = "Plant"))
    ```

    - Join both tables, but keeping just those observations which have BOTH light and size measurement (this merits an extra point)

```{r question5b}

data2 <- inner_join(data_long_all, data_light,
                  by = c("Site" = "Site", "Tree_number" = "Plant", "Year"))

data2b <- left_join(data_long, data_light,
                  by = c("Site" = "Site", "Tree_number" = "Plant", "Year"))
```
